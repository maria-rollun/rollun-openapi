# Правила создание openapi манифеста
Генераторы заточены под версию openapi **3.0.0** по этому использование других версий не поддерживается.
Для ознакомления с документацией swagger (openapi) перейдите по [ссылке](https://swagger.io/docs/).   

## Quick Start видео
Для просмотра перейдите по [ссылке](https://drive.google.com/file/d/1zpAmTMbgpgUpxWgWGOOkJFYDp0AqIrRN/view?usp=sharing).

## Блоки манифеста
Пример манифеста вы можете посмотреть [здесь](../openapi-hello-user.yaml). Описание блоков будет базироваться на манифесте с примера.

Манифест разделен на несколько логических блоков:
 * **openapi** - здесь нужно указать версию
 
   ``openapi: 3.0.0``, всегда нужно указывать версию 3.0.0 так как другая не поддерживается
 * **info** - здесь нужно указать общую информацию об апи. Например название, версию, описание и т.д.
   ```
   info:
     version: "1"
     title: HelloUser
   ```
   генератор использует version и title в кодогенерации. title используется как имя модуля, а версия как версия. То есть если в генераторе будет указано то что в примере, то файлы будут в ```src/HelloUser/src/OpenAPI/V1/```, неймспейс будет строиться по этому же принципу. 
 * **servers** - здесь нужно указать сервера (hosts)
   ```
   servers:
     - url: http://HOSTNAME/openapi/HelloUser/v1 
   ``` 
   данный параметр используется генератором для определения полного пути. Если рассматривать с точки зрения клиентского кода то этот параметр определяет куда можно отправлять, а если з точки зрения серверной части то по какому пути будут доступны ваши обработчики. Более детально про возможности можете прочесть [здесь](https://swagger.io/docs/specification/api-host-and-base-path/). Так же, по умолчанию в сгенерированом коде, запрос отправляется на первый хост - [пример](https://github.com/rollun-com/rollun-openapi/blob/410ee5877698daf189d49499011bb607000b096b/src/HelloUser/src/OpenAPI/V1/Client/Api/HelloApi.php#L87).
индекс пробрасывается из Rest директории. Что бы кастомизировать создание сервиса, нужно перекрыть метод createApi из BaseAbstract класса.
 * **tags** - здесь нужно указать метки, условное группирование методов по определенному признаку. **ВАЖНО** Теги должны называтся с большой буквы, для корректной генерации названий фалов и классов.
   ```
   tags:
     - name: User
     - name: Hello
   ```  
   как видно я указал при помощи тегов, что все пути буду разделены на две группы: User, Hello. Это очень важный параметр так как при помощи меток генератор определяет какие имена будут у классов которые он создаст. 
 * **paths** - здесь нужно указать все пути на которые будет возможность отправлять запросы, и получать ответы.
   ```
   paths:
     /User:
       post:
         tags:
           - User
         responses:
           '201':
             description: Created
             content:
               application/json:
                 schema:
                   $ref: '#/components/schemas/UserResult'
           '400':
             description: Bad Request
             content:
               application/json:
                 schema:
                   $ref: '#/components/schemas/ErrorResult'
           '500':
             description: Internal error
             content:
               application/json:
                 schema:
                   $ref: '#/components/schemas/ErrorResult'
         requestBody:
           required: true
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/User'
   ``` 
   как видно здесь мы указываем путь на который есть возможность отправлять запрос. Также мы указываем метки к которым относиться путь. Важно указывать только одну метку так как в ином случае возникнет путаница, генератор создаст несколько классов который будут обрабатывать один и тот же путь. Описывая путь нужно указывать HTTP методы которые возможны для конкретного пути. В примере мы показали что для ```/User``` возможен только HTTP POST метод. Также нужно описать запрос и ответы. Важно при описании тела запроса или ответа, всегда использовать ссылки на схемы, точно так как в примере. Генератор создает DTO объекты на базе описанных вами схем с теми же именами. В случае если вы не будете ссылаться на схемы, а просто опишете объект, то генератор создаст DTO объекты с техническими названиями, что не удобно в дальнейшем использовании.
 * **operationId** - Запрещен к использованию.
 * **components** - здесь нужно указать дополнительные компоненты на которые будут ссылаться path.
   ```
   components:
     schemas:
       Message:
         type: object
         required:
           - level
           - text
         properties:
           level:
             type: string
             description: 'Message level  (like in a logger)'
             example: 'error'
           text:
             type: string
             description: 'Message text'
             example: 'Something wrong.'
           context:
             type: array
             description: 'Message context (like in a logger)'
             items:
               type: string
   ```
   как видно здесь мы описали объект Message со всеми его полями. Генератор создаст DTO объект Message где будут указаны все поля описанные здесь, а также в классе будет описана валидация, которая также будет создана согласно описанного в манифесте.  
